"use strict";(("undefined"!=typeof self?self:global).webpackChunkopen=("undefined"!=typeof self?self:global).webpackChunkopen||[]).push([[472],{99922:(e,t,a)=>{a.d(t,{o:()=>l});var n=a(44794),i=a(44503);function l(){return{version:(0,n.W6)(i.GE)?2:1}}},50977:(e,t,a)=>{a.r(t),a.d(t,{Episode:()=>Ve,default:()=>Ye,parseReleaseDate:()=>Ge});var n=a(67294),i=a.n(n),l=a(65858),r=a(16528),o=a(69518),s=a.n(o),d=a(96685),c=a(44794),m=a(44503),u=a(76343),p=a(62890);const k="Ck11dU0ipD52SdUcCdl3",v="EzPp2M6sPnJCpwd8Jbi7",E="WL5zy4E6QItBeCT6BdYq",g="HXLKjt4pA15hJqLJxnWA",y="FdpyBxDdNrrL27wrINsy",b="QJPX1kGtuCNg6EUL2LAS",h="ltjunXlP2FwPEVF992n9",S="PFsc4aA7WK6jCXfONJal",P="C_bheWFgPaQZ3AA2SgG5",N=({cardHeaderText:e,cardBodyText:t,buttonText:a,buttonTarget:n})=>(0,c.W6)(m.Xd)?i().createElement("div",{className:h},i().createElement("div",{className:S},i().createElement(u.Dy,{as:"span",variant:d.LF.balladBold,color:"var(--spice-text)"},e),i().createElement(u.Dy,{as:"span",variant:d.LF.viola,color:"var(--spice-text)"},t)),i().createElement(p.z,{version:"primary",linkTo:s().from(n).toURLPath(!0),className:P},a)):null;var f=a(20657),U=a(30947),w=a(11414),T=a(20246),C=a(18261),F=a(20238),x=a(62975),A=a(57978),D=a(34325),I=a(43620),L=a(23716),M=a(84242),R=a(52759),B=a(8341),_=a(52404),z=a(86649),W=a(7073),O=a(92408),X=a(84788),K=a(84629),Z=a(67154),$=a.n(Z),V=a(99922),Y=a(74849);const G=(0,n.lazy)((()=>a.e(396).then(a.bind(a,88396))));function J(e){const t=(0,Y.m)(),a=(0,V.o)();return t?i().createElement(n.Suspense,{fallback:!0},i().createElement(G,$()({reason:"Episode page"},a,e))):null}var Q=a(1663),q=a(95661),H=a(22345),j=a(42273),ee=a(59482),te=a(72907),ae=a(55911),ne=a(46245),ie=a(18061),le=a(8247),re=a(72917),oe=a(95806);const se="activation-trigger-mme",de=({episodeUri:e,showUri:t,isLocked:a,isPlaying:n,isPlayDisabled:r,playButtonPlayLabel:o,playButtonPauseLabel:d,onClick:c})=>{const m=(0,l.v9)((e=>{var t;return null===(t=e.platform)||void 0===t?void 0:t.isBrowser})),u=i().createElement(ie.F,{property:le.iY,renderOldExperience:()=>i().createElement(oe.l,{showUri:t,enabled:a,renderInline:!1},i().createElement(ae.JM,{size:ae.qE.lg,onClick:c,isPlaying:n,disabled:r,locked:a,ariaPlayLabel:o,ariaPauseLabel:d})),renderNewExperience:()=>i().createElement(oe.l,{showUri:t,enabled:a,renderInline:!1},i().createElement(ne.fh,{size:"lg",onClick:c,isPlaying:n,disabled:r,locked:a,ariaPlayLabel:o,ariaPauseLabel:d}))});return m?i().createElement(re.c,{id:se,targetURI:s().from(e)},u):u};var ce=a(67892),me=a(32626),ue=a(5944),pe=a(60410),ke=a(31610);const ve="UVWRbDQd2DM0ShkvMq54",Ee="Eoy1M3AAKeAUI9cNWsuq",ge="rmgkmccGmTBvrw7gXMyS",ye="JKIiOrx9EhZCkyBsu7YI";function be(e){return(null==e?void 0:e.replace(/T.*/,""))||""}function he(e){const t=s().from(e);return`/show/${s().hexToId((null==t?void 0:t.id)||"")}`}const Se=i().memo((({chapter:e})=>{var t;const{name:a,uri:r,playedState:o,contentRating:s,duration:d,releaseDate:c,playability:m}=e,u=e.book,k=e.coverArt.length?e.coverArt:u.coverArt||[],v=null===(t=k[0])||void 0===t?void 0:t.url,E=(0,I.Z)(v||null),g=(0,l.I0)(),[y,b]=(0,n.useState)(o.state===W.sY.Completed),{triggerPlay:h,togglePlay:S,isPlaying:P,isActive:N}=(0,M.n)({uri:r},{featureIdentifier:"episode"}),w=(0,B.Y)((e=>{var t;return null!==(t=(0,ue.k)(e))&&void 0!==t?t:void 0})),T=(0,pe.S)(e),{badges:F}=(0,X.r)({contentRating:null==s?void 0:s.label}),x=(0,n.useCallback)((e=>{!m.playable&&F.nineteen&&(e.stopPropagation(),g((0,K.RM)(r||"")))}),[r,m.playable,F.nineteen,g]),D=(0,n.useCallback)((e=>{T||(N?S():h({seekTo:e}))}),[T,N,S,h]);(0,n.useEffect)((()=>{const e=new URLSearchParams(location.search);if(e.has("t")){const t=e.get("t")||"0",a=1e3*parseInt(t,10);a<=d.milliseconds&&D(a)}}),[d,D]);const L=!T&&!m.playable,R=u.uri,_=u.name,z=f.ag.get("tracklist.a11y.play",a,_),Z=f.ag.get("tracklist.a11y.pause",a,_);return i().createElement("section",{"data-testid":"chapter",className:ve},i().createElement(j.gF,{backgroundColor:E},i().createElement(ee.W,null,i().createElement(te.i,{text:a})),i().createElement("div",{className:ge},i().createElement(C._,{menu:i().createElement(H.r,{uri:r,isPlayed:y,onMarkAsPlayed:b,contextUri:r})},i().createElement(j.Oe,{loading:"eager",name:a,images:k,placeholderType:"episode",shape:j.Kc.ROUNDED_CORNERS}))),i().createElement(j.sP,null,i().createElement(j.dy,{small:!0,uppercase:!0},f.ag.get("web-player.audiobooks.chapter")),i().createElement(C._,{menu:i().createElement(H.r,{uri:r,isPlayed:y,onMarkAsPlayed:b,contextUri:r})},i().createElement(j.xd,{dragUri:r,dragLabel:a},i().createElement("span",{"data-testid":"chapterTitle"},a))),i().createElement(C._,{menu:i().createElement(H.r,{uri:r,isPlayed:y,onMarkAsPlayed:b,contextUri:r})},i().createElement(ce.Z,{to:he(R)},i().createElement(j.dy,{large:!0,bold:!0},i().createElement("span",{"data-testid":"bookTitle"},_)))))),i().createElement(U.o,{backgroundColor:E},i().createElement(U.F,null,F.nineteen&&i().createElement(A.X,{className:Ee,size:16}),i().createElement(O.E,{size:O.$.LARGE,fullyPlayed:y,durationMs:d.milliseconds,releaseDate:be(null==c?void 0:c.isoString),resumePositionMs:o.playPositionMilliseconds,isPlaying:P,position:N&&w||void 0})),i().createElement(U.F,null,i().createElement("div",{onClick:x},i().createElement(de,{episodeUri:r,showUri:R,isLocked:T,onClick:()=>{D(o.playPositionMilliseconds)},isPlaying:P,isPlayDisabled:L,playButtonPlayLabel:z,playButtonPauseLabel:Z})),!T&&i().createElement(ke.o,{uri:r,bookUri:R}),i().createElement(me.yj,{menu:i().createElement(H.r,{uri:r,isPlayed:y,onMarkAsPlayed:b,contextUri:r})},i().createElement(q.z,{label:f.ag.get("more.label.context",a)})))),i().createElement("div",{className:"contentSpacing"},i().createElement(p.z,{version:"outlined",linkTo:he(R),className:ye},"See all chapters")))}));var Pe=a(56802),Ne=a(38894),fe=a(37483),Ue=a(51871),we=a(25988),Te=a(70369),Ce=a(54280),Fe=a(38470),xe=a(28248),Ae=a(74600),De=a(28120);const Ie=({uri:e,segmentCount:t})=>{const a=(0,Ce.G)(),l=(0,n.useCallback)((async(t,n)=>{const i=Math.ceil(t/2);try{return function(e,t,a){return e.reduce(((e,n,i)=>((i>0||t>0)&&e.push({type:"SPACER",id:`spacer-${e.length}`}),"MUSIC"===n.type?e.push(function(e,t,a){return{type:"MUSIC",index:t,uri:a.uri,episodeUri:e,start:a.start,stop:a.stop,duration:a.duration,name:a.track.name,artists:a.track.artists,album:a.track.album,playable:a.track.playable}}(a,i,n)):"TALK"===n.type&&e.push(function(e,t,a){return{type:"TALK",index:t,uri:e,title:a.title,subtitle:a.subtitle,start:a.start,stop:a.stop,duration:a.duration,showUri:a.show.uri,showName:a.show.name}}(a,i,n)),e)),[])}(await a.getSegments(e,i,n),i,e)}catch(e){return[]}}),[a,e]),r=(0,n.useCallback)((t=>{switch(t.type){case"SPACER":return i().createElement("div",{key:t.id,className:De.Z.spacerRow});case"MUSIC":return i().createElement(xe.Z,$()({key:`${e}-${t.index}`},t));case"TALK":return i().createElement(Ae.t,$()({key:`${e}-${t.index}`},t));default:return(0,Fe.U)(t)}}),[e]),o=f.ag.get("music_and_talk.in_this_episode");return i().createElement("div",null,i().createElement(u.Dy,{as:"h2",variant:d.LF.canon,color:"var(--spice-text)",className:De.Z.header},o),i().createElement(xe.Pv,{ariaLabel:o,hasHeaderRow:!0,rowPlaceholder:xe.hU,columns:[xe.QD.TITLE,xe.QD.ALBUM_OR_SHOW,xe.QD.DURATION],renderRow:r,fetchTracks:l,resolveUri:e=>"MUSIC"===e.type?e.uri:"",limit:50,nrTracks:2*t-1,testID:"music-and-talk-tracklist"}))};var Le=a(98984),Me=a(94184),Re=a.n(Me),Be=a(4348);const _e="axX_dOb7KXxh2BhADfuQ",ze="DIz7crU76YDtXXLx34nF",We="R2a58pDnuIWBldpbVPRr",Oe=i().memo((({title:e,episodes:t,className:a})=>i().createElement("div",{className:Re()(_e,a)},i().createElement(u.Dy,{as:"h2",variant:d.LF.canon,className:ze},e),i().createElement("div",{className:We},t.map(((e,t)=>i().createElement(Be.B,{key:e.id,entity:e,index:t}))))))),Xe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"getRecommendedEpisodes"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"uri"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"limit"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"episode"},arguments:[{kind:"Argument",name:{kind:"Name",value:"uri"},value:{kind:"Variable",name:{kind:"Name",value:"uri"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"recommendedEpisodes"},arguments:[{kind:"Argument",name:{kind:"Name",value:"limit"},value:{kind:"Variable",name:{kind:"Name",value:"limit"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"items"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"episode"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"uri"}},{kind:"Field",name:{kind:"Name",value:"name"}},{kind:"Field",name:{kind:"Name",value:"description"}},{kind:"Field",name:{kind:"Name",value:"releaseDate"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"isoString"}}]}},{kind:"Field",name:{kind:"Name",value:"duration"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"totalMilliseconds"}}]}},{kind:"Field",name:{kind:"Name",value:"contentRating"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"label"}}]}},{kind:"Field",name:{kind:"Name",value:"coverArt"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"sources"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"url"}},{kind:"Field",name:{kind:"Name",value:"width"}},{kind:"Field",name:{kind:"Name",value:"height"}}]}}]}},{kind:"Field",name:{kind:"Name",value:"podcast"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"coverArt"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"sources"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"url"}},{kind:"Field",name:{kind:"Name",value:"width"}},{kind:"Field",name:{kind:"Name",value:"height"}}]}}]}}]}}]}}]}}]}}]}}]}}]},Ke=({uri:e,limit:t})=>{var a;const{data:l}=(r={uri:e,limit:t},o={cacheTime:15*Le.y},(0,Le.a)(Xe,r,o));var r,o;const s=(0,n.useMemo)((()=>{var e;return((null==l||null===(e=l.episode)||void 0===e?void 0:e.recommendedEpisodes.items)||[]).map((e=>{var t,a,n,i,l,r,o;return{id:e.episode.id,uri:e.episode.uri,name:e.episode.name,description:null!==(t=e.episode.description)&&void 0!==t?t:"",explicit:(null===(a=e.episode.contentRating)||void 0===a?void 0:a.label)===W.KS.Explicit,release_date:Ge(null===(n=e.episode.releaseDate)||void 0===n?void 0:n.isoString),duration_ms:e.episode.duration.totalMilliseconds,images:null!==(i=null===(l=e.episode.coverArt)||void 0===l?void 0:l.sources)&&void 0!==i?i:[],show:{images:null!==(r=null===(o=e.episode.podcast.coverArt)||void 0===o?void 0:o.sources)&&void 0!==r?r:[]}}}))}),[null==l||null===(a=l.episode)||void 0===a?void 0:a.recommendedEpisodes.items]);return(null==s?void 0:s.length)>0?i().createElement(Oe,{title:f.ag.get("mwp.entity.might.like"),episodes:s}):null};var Ze=a(68107);function $e(e){const t=s().from(e);return`/show/${s().hexToId((null==t?void 0:t.id)||"")}`}const Ve=({episode:e})=>{var t,a,o,h,S,P,_,z;const{uri:Z,name:$,sharingInfo:V,playedState:Y,episodeType:G,description:Q,htmlDescription:H,podcastSubscription:ae,contentRating:ne,segmentsCount:ie,playability:le,coverArt:re,releaseDate:oe,podcast:me,contentInformation:ue}=e,pe=(0,r.TH)(),ke=(0,l.I0)(),ve=(0,L.g)(),Ee=(0,Pe.o)(),ge=(0,c.W6)(m.Cz),[ye,be]=(0,n.useState)(Y.state===W.sY.Completed),he=(0,c.W6)(m.Be),Se=void 0!==ie&&ie>0&&he,Ce=(0,Ne.g)(),{triggerPlay:Fe,togglePlay:xe,isPlaying:Ae,isActive:De}=(0,M.n)({uri:Z},{featureIdentifier:"episode"}),[Le]=(0,R.z)(1e4,(e=>{var t;return(null==e||null===(t=e.item)||void 0===t?void 0:t.uri)===Z})),Me=(0,B.Y)((e=>{var t;return null!==(t=null==e?void 0:e.isPaused)&&void 0!==t?t:void 0})),Re=function(e,t,a,n,l){const r=t===W.Wf.Episode;return(0,D.G3)(e,n,a,l)?i().createElement(D.Fg,{isMusicAndTalk:r}):r?f.ag.get("type.showEpisode"):f.ag.get("type.podcastEpisode")}(Z,G||W.Wf.Unknown,Y.playPositionMilliseconds,Ge(null==oe?void 0:oe.isoString),Y.state===W.sY.Completed),Be=re[0].url,_e=(0,I.Z)(Be||null),ze=(0,l.v9)((e=>{var t;return null===(t=e.platform)||void 0===t?void 0:t.isBrowser})),We=ae.isPaywalled&&!ae.isUserSubscribed,Oe=(0,Ze.s)(e,me),{badges:Xe}=(0,X.r)({contentRating:null==ne?void 0:ne.label}),Ve=(0,n.useCallback)((e=>{!le.playable&&Xe.nineteen&&(e.stopPropagation(),ke((0,K.RM)(Z||"")))}),[Z,le.playable,Xe.nineteen,ke]),Ye=(0,n.useCallback)(((e,t=!0)=>{if(We)return;let a="play";!Ae||0!==e&&t||(a="pause"),Ee({intent:a,targetUri:Z,type:"click",itemIdSuffix:e>0?"podcast-description-timestamp":"button"}),G===W.Wf.Episode&&ze?x.y.set((()=>({triggerId:se,triggerAction:null}))):De&&!t?Ce?Me?ve.resume():ve.pause():xe():Ce?Oe({seekTo:e}):Fe({seekTo:e})}),[We,Ae,Ee,Z,G,ze,De,Ce,Me,ve,xe,Oe,Fe]),Je=(0,n.useCallback)((()=>{Ee({intent:"expand-description",type:"click"})}),[Ee]),Qe=Q||ge&&H;(0,n.useEffect)((()=>{if(e){const t=new URLSearchParams(pe.search);if(t.has("t")){const a=t.get("t")||"0",n=1e3*parseInt(a,10);n<=e.duration.milliseconds&&Ye(n)}}}),[e]);const qe=!We&&!e.playability.playable,He=f.ag.get("tracklist.a11y.play",e.name,null===(t=e.podcast)||void 0===t?void 0:t.name),je=f.ag.get("tracklist.a11y.pause",e.name,null===(a=e.podcast)||void 0===a?void 0:a.name),et=null===(o=e.podcast)||void 0===o?void 0:o.uri,tt=null===(h=s().from(et))||void 0===h?void 0:h.toURLPath(!0);return i().createElement("section",{"data-testid":"episode",className:k},i().createElement(Te.$,null,f.ag.get("podcasts.episode.seo.title",{name:e.name,show:null!==(S=null===(P=e.podcast)||void 0===P?void 0:P.name)&&void 0!==S?S:""})),i().createElement(j.gF,{backgroundColor:_e},i().createElement(ee.W,null,i().createElement(te.i,{text:e.name,dragUri:Z,dragLabel:e.name})),i().createElement("div",{className:b},i().createElement(C._,{menu:i().createElement(we.k,{uri:e.uri,sharingInfo:e.sharingInfo,showUri:et,contextUri:e.uri,isPlayed:ye,onMarkAsPlayed:be})},i().createElement(j.Oe,{loading:"eager",name:e.name,images:e.coverArt,placeholderType:"episode",shape:j.Kc.ROUNDED_CORNERS}))),i().createElement(j.sP,null,i().createElement(j.dy,{small:!0,uppercase:!0},Re),i().createElement(C._,{menu:i().createElement(we.k,{uri:Z,sharingInfo:V,showUri:et,contextUri:Z,isPlayed:ye,onMarkAsPlayed:be})},i().createElement(j.xd,{dragUri:Z,dragLabel:$},i().createElement("span",{"data-testid":"episodeTitle"},$))),i().createElement(C._,{menu:i().createElement(we.k,{uri:e.uri,sharingInfo:e.sharingInfo,showUri:et,contextUri:e.uri,isPlayed:ye,onMarkAsPlayed:be})},i().createElement(ce.Z,{to:$e(et)},i().createElement(j.dy,{large:!0,bold:!0},i().createElement("span",{"data-testid":"showTitle"},null===(_=e.podcast)||void 0===_?void 0:_.name)))))),i().createElement(U.o,{backgroundColor:_e},i().createElement(U.F,null,Xe.nineteen&&i().createElement(A.X,{className:y,size:16}),i().createElement(O.E,{size:O.$.LARGE,fullyPlayed:ye,durationMs:e.duration.milliseconds,releaseDate:Ge(null===(z=e.releaseDate)||void 0===z?void 0:z.isoString),resumePositionMs:Y.playPositionMilliseconds,isPlaying:Ae,position:De&&Le||void 0})),i().createElement(U.F,null,i().createElement("div",{onClick:Ve},i().createElement(de,{episodeUri:e.uri,showUri:et,isLocked:We,onClick:()=>{Ye(Y.playPositionMilliseconds,!1)},isPlaying:Ae,isPlayDisabled:qe,playButtonPlayLabel:He,playButtonPauseLabel:je})),!We&&i().createElement(fe.p,{uri:e.uri,showUri:et}),i().createElement(Ue.w,{uri:e.uri,size:w.q.md}),i().createElement(T.y,{menu:i().createElement(we.k,{uri:e.uri,sharingInfo:e.sharingInfo,showUri:et,contextUri:e.uri,isPlayed:ye,onMarkAsPlayed:be})},i().createElement(q.z,{label:f.ag.get("more.label.context",e.name)})))),i().createElement("div",{className:"contentSpacing"},i().createElement(i().Fragment,null,(Qe||ue)&&i().createElement(u.Dy,{as:"h2",variant:d.LF.canon,color:"var(--spice-text)",className:E},f.ag.get("episode.description-title")),ue&&i().createElement(N,{cardHeaderText:ue.cardHeaderText,cardBodyText:ue.cardBodyText,buttonText:ue.buttonText,buttonTarget:ue.buttonTarget}),Qe&&i().createElement(F.o,{className:v,onTimeStampClick:Ye,maxLines:4,onExpanded:Je,content:(e.description||"").trim(),htmlContent:ge&&e.htmlDescription?e.htmlDescription:void 0,LinkComponent:ce.Z,enableTimestamps:e.playability.playable})),Se&&i().createElement(Ie,{segmentCount:ie,uri:e.uri}),tt&&i().createElement(p.z,{version:"outlined",linkTo:tt,className:g},f.ag.get("episode.see_all_episodes")),i().createElement(J,{uri:Z}),i().createElement(Ke,{uri:Z,limit:6})))},Ye=i().memo((()=>{const{episodeId:e}=(0,r.UO)(),t=s().episodeURI(e).toURI(),a=(0,c.W6)(m.uB),l=(0,_.I)(t,a);return l?(0,z.Ey)(l)?i().createElement(n.Suspense,{fallback:null},i().createElement(Se,{chapter:l})):i().createElement(n.Suspense,{fallback:null},i().createElement(Ve,{episode:l})):i().createElement(Q.h,{hasError:!1,errorMessage:f.ag.get("error.not_found.title.podcast")})}));function Ge(e){return(null==e?void 0:e.replace(/T.*/,""))||""}}}]);
//# sourceMappingURL=xpui-routes-episode.js.map