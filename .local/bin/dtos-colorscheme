#!/usr/bin/env bash
#
# Script name: dtos-colorscheme
# Description: Change colorscheme in DTOS.
# Dependencies: dmenu, dmscripts
# GitLab: https://www.gitlab.com/dwt1/dtos
# License: https://www.gitlab.com/dwt1/dtos/LICENSE
# Contributors: Derek Taylor

# Set with the flags "-e", "-u","-o pipefail" cause the script to fail
# if certain things happen, which is a good thing.  Otherwise, we can
# get hidden bugs that are hard to discover.
set -euo pipefail

# shellcheck disable=SC1091
source "$HOME/.config/dmscripts/config"

# options=("DoomOne"
options=(
# "Dracula"
# "GruvboxDark"
# "MonokaiPro"
# "Nord"
# "OceanicNext"
# "Palenight"
# "SolarizedDark"
# "SolarizedLight"
# "TomorrowNight"
"Latte"
"Frappe"
"Macchiato"
"Mocha")

choice=$(printf '%s\n' "${options[@]}" | ${DMENU} 'Choose color scheme:' "${@}")
choicelower=$(echo "$choice" | awk '{print tolower($0)}')

if [ "$choice" ]; then
    sed  -i "s/import Colors.*/import Colors.$choice/g" "$HOME"/.xmonad/README.org || echo "Cannot modify README.org"
    sed  -i "s/import Colors.*/import Colors.$choice/g" "$HOME"/.xmonad/xmonad.hs || echo "Cannot modify xmonad.hs"
    sed  -i 's`@theme "/home/manasmengle/.local/share/rofi/themes/catppuccin-.*`@theme "/home/manasmengle/.local/share/rofi/themes/catppuccin-'$choice.rasi'"`g' /home/manasmengle/.config/rofi/config.rasi || echo "Cannot modify config.rasi"
    sed  -i 's`include-file = colors/.*`include-file = colors/'$choice'.ini`g' /home/manasmengle/.config/polybar/config.ini || echo "Cannot modify config.ini"
    sed  -i 's`COLORSCHEME=.*`COLORSCHEME="'$choicelower'"`g' /home/manasmengle/.config/bspwm/bspwmrc || echo "Cannot modify bspwmrc"
    sed  -i 's`current_theme           = catppuccin-.*`current_theme           = catppuccin-'$choicelower'`g' /home/manasmengle/.config/spicetify/config-xpui.ini || echo "Cannot modify config-xpui.ini"
    # xmonad --restart
    if command -v xmonad &> /dev/null; then
      xmonad --restart
    fi
    if command -v bspc &> /dev/null; then
      bspc wm -r
    fi
    # bspc wm -r 
    # /home/manasmengle/.config/polybar/launch.sh
    spicetify apply

    sed -i "s/^colors: .*/colors: \*$choice/g" "$HOME"/.config/alacritty/alacritty.yml

# DOOM EMACS

# What to do if we just escape without choosing anything.
else
  echo "Program terminated." && exit 0
fi
